<data>
    <record id="s_stock_picking_form_inherit" model="ir.ui.view">
        <field name="name">stock.picking.form.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <!--            <xpath expr="//button[@name='button_validate']" position="attributes">-->
            <!--                <attribute name="confirm">Bạn chắn chắn muốn xác nhận số lượng này?</attribute>-->
            <!--            </xpath>-->

            <xpath expr="//field[@name='location_id']" position="after">
                <field name="transfer_type" widget="badge"
                       decoration-primary="transfer_type == 'in'" decoration-warning="transfer_type == 'out'"/>
                <field name="is_pos_order" groups="base.group_no_one"/>
                <field name="is_edited_do_m2_return" invisible="1"/>
                <field name="s_warehouse_id" groups="base.group_no_one"/>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="before">
                <field name="receiver_id"
                       attrs="{'invisible': [('transfer_out_id','=', False),('transfer_in_id','=', False)],'readonly':[('state','=', 'done')]}"/>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="attributes">
                <attribute name="domain">
                    [('usage', 'not in', ['view']),('warehouse_id_store','=',s_warehouse_id),('s_is_transit_location',
                    '=', False),('scrap_location', '=', False)]
                </attribute>
                <attribute name="attrs">
                    {'readonly':[('is_edited_do_m2_return', '=', False), ('state', 'not in',
                    ['draft','confirmed','assigned'])], 'invisible': 0}
                </attribute>
            </xpath>
            <xpath expr="//button[@name='action_set_quantities_to_reservation']" position="attributes">
                <!--                <attribute name="invisible">1</attribute>-->
                <attribute name="attrs">{'invisible': [('show_validate', '=', False)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='location_id']" position="attributes">
                <attribute name="attrs">
                    {'readonly':[('is_edited_do_m2_return', '=', False),
                    ('state', 'not in', 'draft')],
                    'invisible': 0,
                    'required':True}
                </attribute>
                <attribute name="domain">
                    [('usage', 'not in', ['view']),('warehouse_id_store','=',s_warehouse_id),('s_is_transit_location',
                    '=', False),('scrap_location', '=', False)]
                </attribute>
            </xpath>
            <xpath expr="//field[@name='location_id']" position="after">
                <field name="is_edited_do_m2_return" invisible="1"/>
            </xpath>
            <xpath expr="//button[@name='action_confirm']" position="attributes">
                <attribute name="attrs">{'invisible':[('state', 'not in', ('draft','waiting','confirmed'))]}</attribute>
            </xpath>
            <xpath expr="//button[@name='action_cancel']" position="attributes">
                <attribute name="confirm">Bạn muốn hủy phiếu nhập/xuất này?</attribute>
            </xpath>
            <xpath expr="//button[@name='action_picking_move_tree']" position="after">
                <field name="transfer_in_id" invisible="1"/>
                <!--                attrs="{'invisible': [('transfer_in_id','!=', False)]}"-->
                <button name="action_view_stock_package" class="oe_stat_button" icon="fa-truck" type="object"
                        attrs="{'invisible': [('transfer_in_id','!=', False)]}">

                    <div class="o_form_field o_stat_info">
                        <span class="o_stat_text">
                            <field name="count_stock_package"/>
                        </span>
                        <span class="o_stat_text">Kiện hàng</span>
                    </div>
                </button>
            </xpath>

            <xpath expr="//button[@name='action_see_move_scrap']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="transfer_in_id" readonly="1" attrs="{'invisible':[('transfer_in_id','=',False)]}"/>
                <field name="transfer_out_id" readonly="1" attrs="{'invisible':[('transfer_out_id','=',False)]}"/>
                <field name="transfer_note"
                       attrs="{'invisible': [('transfer_in_id', '=', False),('transfer_out_id', '=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='date_done']" position="before">
                <field name="deadline" force_save="1" readonly="1"
                       decoration-warning="state not in ('done', 'cancel') and deadline &lt; now"
                       decoration-danger="state not in ('done', 'cancel') and deadline &lt; current_date"
                       decoration-bf="state not in ('done', 'cancel') and (deadline &lt; current_date or deadline &lt; now)"/>
            </xpath>
            <xpath expr="//field[@name='date_done']" position="after">
                <field name="delivery_priority_type" attrs="{'readonly':[('state','=', 'done')]}"/>
            </xpath>

            <!--            <xpath expr="//field[@name='move_ids_without_package']" position="attributes">-->
            <!--                <attribute name="attrs">{'readonly': ['|',('transfer_in_id','!=', False),'&amp;', ('state', '=', 'done'), ('is_locked', '=', True)]}</attribute>-->
            <!--            </xpath>-->
            <xpath expr="//field[@name='move_ids_without_package']/tree" position="inside">
                <field name="is_transfer_in" invisible="1"/>
                <field name="is_package" string='Là kiện hàng' widget="boolean_toggle"
                       attrs="{'column_invisible': ['|',('parent.transfer_in_id','!=', False),('parent.immediate_transfer','=', True)]}"/>
                <field name="stock_package_ids" widget="many2many_tags" readonly="1" force_save="1"
                       attrs="{'column_invisible': ['|',('parent.transfer_in_id','!=', False),('parent.immediate_transfer','=', True)]}"/>
                <button name="action_add_to_package" string="Thêm vào kiện hàng" type="object" class="oe_highlight"
                        attrs="{'invisible':['|','|',('state','=', 'done'), ('is_transfer_in','=',True),('is_package','=', False),('is_package','=', False)]}"/>
            </xpath>
            <xpath expr="//page[@name='operations']/field[@name='move_ids_without_package']/tree/field[@name='product_id']"
                   position="after">
                <field name="ma_san_pham"/>
                <field name="ma_cu"/>
            </xpath>
            <xpath expr="//button[@name='action_show_details']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_package','=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='quantity_done']" position="attributes">
                <attribute name="attrs">{'readonly': [('is_package','=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='quantity_done']" position="after">
                <field name="inventory_qty_note"/>
            </xpath>
            <xpath expr="//field[@name='product_uom_qty']" position="after">
                <field name="initial_need_qty"/>
            </xpath>
            <xpath expr="//field[@name='origin']" position="before">
                <field name="s_origin" attrs="{'invisible': [('s_origin','=',False)]}"/>
                <field name="pos_order_id" invisible="1"/>
                <!--                <field name="s_origin"/>-->
            </xpath>
            <xpath expr="//field[@name='origin']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>
            <!--            <xpath expr="//button[@name='button_validate']" position="attributes">-->
            <!--                <attribute name="groups">advanced_sale.s_boo_group_ecom,advanced_sale.s_boo_group_thu_ngan</attribute>-->
            <!--            </xpath>-->
            <xpath expr="//button[@name='button_scrap']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>

            <xpath expr="//button[@name='action_toggle_is_locked'][1]" position="attributes">
                <attribute name="attrs">{'invisible':['|', ('state', 'in', ('draft','cancel','done')), ('is_locked',
                    '=', False)]}
                </attribute>
            </xpath>
            <xpath expr="//notebook/page[@name='detailed_operations']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='%(stock.act_stock_return_picking)d']" position="attributes">
                <attribute name="groups">
                    base.group_system,advanced_sale.s_boo_group_ecom,advanced_sale.s_boo_group_hang_hoa,advanced_sale.s_boo_group_dieu_phoi,advanced_sale.s_boo_group_thu_ngan
                </attribute>
            </xpath>
            <xpath expr="//button[@name='%(stock.act_stock_return_picking)d']" position="attributes">
                <attribute name="attrs">{'invisible': ['|','|','|','|',('state', '!=', 'done'),('transfer_out_id', '!=',
                    False),('transfer_in_id', '!=', False), ('pos_order_id', '!=', False), ('is_return_magento', '=',
                    True)]}
                </attribute>
            </xpath>
            <xpath expr="//button[@name='button_validate']" position="attributes">
                <attribute name="groups">
                    advanced_sale.s_boo_group_administration,advanced_sale.s_boo_group_ecom,advanced_sale.s_boo_group_thu_ngan,advanced_sale.s_boo_group_hang_hoa,advanced_sale.s_boo_group_dieu_phoi,advanced_sale.s_boo_group_kiem_ke
                </attribute>
            </xpath>
            <xpath expr="//button[@name='action_cancel']" position="attributes">
                <attribute name="groups">
                    advanced_sale.s_boo_group_administration,advanced_sale.s_boo_group_ecom,advanced_sale.s_boo_group_hang_hoa,advanced_sale.s_boo_group_dieu_phoi,advanced_sale.s_boo_group_kiem_ke,advanced_sale.s_boo_group_thu_ngan
                </attribute>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="after">
                <div attrs="{'invisible': [('state','in', ['done', 'cancel'])]}">
                    <br></br>
                    <br></br>
                    <h3 style="color: green" attrs="{'invisible': [('id','=', False)]}">Tính năng Scan Barcode đang
                        Bật
                    </h3>
                    <h3 style="color: red" attrs="{'invisible': [('id','!=', False)]}">Vui lòng lưu lại cấu hình trước
                        khi Scan Barcode
                    </h3>
                    <field name="smart_product_barcode" widget="barcode_handler"/>
                </div>
            </xpath>
            <xpath expr="//field[@name='move_ids_without_package']/tree/field[@name='product_id']" position="before">
                <field name="sequence" widget="handle"/>
            </xpath>
            <xpath expr="//field[@name='move_ids_without_package']/tree/field[@name='product_uom_qty']"
                   position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('is_initial_demand_editable', '=', False), '&amp;', '&amp;',
                    ('show_operations', '=', True), ('is_locked', '=', True), ('is_initial_demand_editable', '=',
                    False)]}
                </attribute>
            </xpath>
            <xpath expr="//field[@name='note']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', '|', ('state', '=', 'done'), ('transfer_in_id', '!=', False),
                    ('transfer_out_id', '!=', False)]}
                </attribute>
            </xpath>
            <xpath expr="//field[@name='location_id']" position="after">
                <field name="s_location_usage" invisible="1"/>
                <field name="s_location_dest_usage" invisible="1"/>
            </xpath>
<!--            <xpath expr="//field[@name='note']" position="attributes">-->
<!--                <attribute name="attrs">{'required': [('origin', '=', False)]}</attribute>-->
<!--            </xpath>-->
            <xpath expr="//field[@name='note']" position="attributes">
                <attribute name="readonly">0</attribute>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="groups">advanced_sale.s_boo_group_administration,advanced_sale.s_boo_group_ecom,
                        advanced_sale.s_boo_group_area_manager,advanced_sale.s_boo_group_hang_hoa,advanced_sale.s_boo_group_dieu_phoi,
                        advanced_sale.s_boo_group_ke_toan</attribute>
            </xpath>
        </field>
    </record>

    <record id="s_stock_picking_tree_inherit" model="ir.ui.view">
        <field name="name">stock.picking.tree.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree"/>
        <field name="arch" type="xml">

            <xpath expr="//tree" position="inside">
                <field name="delivery_priority_type" invisible="1"/>
                <field name="magento_do_id" optional="hide"/>
            </xpath>

            <xpath expr="//tree" position="attributes">
                <attribute name="decoration-danger">(delivery_priority_type != False and deadline &lt; now and state !=
                    'done') or state == 'cancel'
                </attribute>
            </xpath>

            <xpath expr="//field[@name='scheduled_date']" position="after">
                <field name="deadline" widget='remaining_days'/>
            </xpath>
            <xpath expr="//field[@name='date_done']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="create_uid" string="Người tạo"/>
                <field name="create_date"/>
                <field name="date_done" string="Ngày hoàn thành"/>
                <field name="picking_type_code"/>
                <field name="total_quantity_demand"/>
                <field name="total_quantity_done"/>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="transfer_note" optional="show"/>
            </xpath>
            <xpath expr="//field[@name='create_uid']" position="after">
                <field name="code_transfer" optional="hide"/>
            </xpath>
            <xpath expr="//field[@name='location_id']" position="attributes">
                <attribute name="optional">hidden</attribute>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="attributes">
                <attribute name="optional">hidden</attribute>
            </xpath>
            <xpath expr="//field[@name='location_id']" position="after">
                <field name="dia_diem_nguon" optional="show"/>
                <field name="dia_diem_dich" optional="show"/>
            </xpath>
            <xpath expr="//field[@name='origin']" position="after">
                <field name="s_origin" optional="hide"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="before">
                <field name="transfer_type" optional="show" widget="badge"
                       decoration-primary="transfer_type == 'in'" decoration-warning="transfer_type == 'out'"/>
            </xpath>
        </field>
    </record>


    <record id="stock.stock_picking_type_action" model="ir.actions.act_window">
        <field name="context">{'search_default_groupby_warehouse_id':1}</field>
    </record>

    <record id="s_stock_picking_search_view_inherit" model="ir.ui.view">
        <field name="name">Stock Picking View Inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <search>
                <field name="s_origin"/>
                <field name="transfer_note"/>
                <field name="code_transfer"/>
            </search>
            <field name="origin" position="attributes">
                <attribute name="invisible">0</attribute>
            </field>
            <xpath expr="//group" position="inside">
                <filter string="Mã biên lai" name="s_origin" domain="[]" context="{'group_by': 's_origin'}"/>
            </xpath>
        </field>
    </record>

    <record id="s_action_picking_tree_all" model="ir.actions.act_window">
        <field name="name">Phiếu kho trễ</field>
        <field name="res_model">stock.picking</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">tree,kanban,form,calendar</field>
        <field name="domain">[('deadline', '&lt;', datetime.datetime.now()),('state','!=','done')]</field>
    </record>

    <record id="stock.action_validate_picking" model="ir.actions.server">
        <field name="name">Validate</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            if records:
                for rec in records:
                    if rec.state == 'assigned':
                        rec.action_set_quantities_to_reservation()
                        rec.button_validate()
        </field>
    </record>

    <record id="stock.action_unreserve_picking" model="ir.actions.server">
        <field name="name">Unreserve</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            records.action_block_unreserve_picking()
        </field>
    </record>

    <!--    Ẩn 2 menu thừa -->
    <record model="ir.ui.menu" id="stock.menu_action_inventory_tree">
        <field name="groups_id" eval="[(6,0,[ref('advanced_sale.s_boo_group_administration')])]"/>
    </record>
    <record model="ir.ui.menu" id="stock.menu_procurement_compute">
        <field name="groups_id" eval="[(6,0,[ref('base.group_no_one')])]"/>
    </record>
    <record model="ir.ui.menu" id="stock.menu_reordering_rules_replenish">
        <field name="groups_id" eval="[(6,0,[ref('base.group_no_one')])]"/>
    </record>

    <menuitem id="s_late_picking" name="### Phiếu kho trễ" parent="stock.menu_stock_warehouse_mgmt" sequence="999"
              action="s_action_picking_tree_all" groups="stock.group_stock_manager,stock.group_stock_user"/>
    <!--menu sản phẩm và biến thể sản phẩm cho Ecom-->
    <record id="product_template_action_product_ecom" model="ir.actions.act_window">
        <field name="name">Sản phẩm (Ecom)</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'create': False,'edit': False, 'delete': False,'search_default_consumable': 1,
            'default_detailed_type': 'product'}
        </field>
        <field name="search_view_id" ref="stock.product_template_search_form_view_stock"/>
    </record>
    <menuitem id="product_template_action_product_menu_ecom" name="Sản phẩm(Ecom)"
              groups="advanced_sale.s_boo_group_ecom"
              parent="stock.menu_stock_inventory_control" action="product_template_action_product_ecom"
              sequence="55"/>
    <record id="stock_product_normal_action_ecom" model="ir.actions.act_window">
        <field name="name">Biến thể sản phẩm (Ecom)</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">product.product</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="context">{'create': False,'edit': False, 'delete': False}</field>
        <field name="search_view_id" ref="stock.stock_product_search_form_view"/>
    </record>
    <menuitem id="stock_product_normal_menu_ecom" name="Biến thể sản phẩm(Ecom)"
              groups="advanced_sale.s_boo_group_ecom"
              parent="stock.menu_stock_inventory_control" action="stock_product_normal_action_ecom"
              sequence="66"/>
    <!-- Call action server hiển thị truy vết theo Group user-->
    <record id="stock_move_line_thu_ngan_action_server" model="ir.actions.server">
        <field name="name">advanced_inventory.stock_move_line_thu_ngan_action_server</field>
        <field name="model_id" ref="advanced_inventory.model_stock_move_line"/>
        <field name="binding_model_id" ref="advanced_inventory.model_stock_move_line"/>
        <field name="state">code</field>
        <field name="code">action = model.view_stock_move_line_by_group()</field>
    </record>
    <!--    menu Truy vết cho toàn bộ user-->
    <menuitem id="s_stock_move_line_menu_all_users" name="Truy vết"
              parent="point_of_sale.menu_point_rep" action="advanced_inventory.stock_move_line_thu_ngan_action_server"
              sequence="10"/>

    <menuitem id="s_product_moves_inventory_all_user" name="# Truy vết"
              parent="stock.menu_warehouse_report" action="advanced_inventory.stock_move_line_thu_ngan_action_server"
              sequence="151"/>

    <record model="ir.ui.menu" id="stock.all_picking">
        <field name="action" eval="False"/>
    </record>
    <record id="all_stock_picking_action_server" model="ir.actions.server">
        <field name="name">advanced_inventory.stock_move_action_server</field>
        <field name="model_id" ref="advanced_inventory.model_stock_picking"/>
        <field name="binding_model_id" ref="advanced_inventory.model_stock_picking"/>
        <field name="state">code</field>
        <field name="code">action = model.view_stock_picking_by_group()</field>
    </record>
    <!--        <record id="update_show_set_quantities_button_action_server" model="ir.actions.server">-->
    <!--            <field name="name">Update hiển thị button đặt số lượng cho điều chuyển (Trạng thái Sẵn sàng)</field>-->
    <!--            <field name="model_id" ref="advanced_inventory.model_stock_picking"/>-->
    <!--            <field name="binding_model_id" ref="advanced_inventory.model_stock_picking"/>-->
    <!--            <field name="state">code</field>-->
    <!--            <field name="code">-->
    <!--                for rec in records:-->
    <!--                    rec.update_show_set_quantities_button()-->
    <!--            </field>-->
    <!--        </record>-->
    <menuitem action="advanced_inventory.all_stock_picking_action_server" id="menu_all_stock_picking_action_server"
              parent="stock.menu_stock_warehouse_mgmt" name="Điều chuyển hàng" sequence="5" groups="base.group_user"/>
</data>